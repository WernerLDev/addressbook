"use strict";var Contact=function(t){this.id=void 0===t.id?0:t.id,this.photo=void 0===t.photo?"":t.photo,this.contactname=void 0===t.contactname?"":t.contactname,this.workphone=void 0===t.workphone?"":t.workphone,this.mobilephone=void 0===t.mobilephone?"":t.mobilephone,this.workemail=void 0===t.workemail?"":t.workemail,this.privateemail=void 0===t.privateemail?"":t.privateemail,this.address=void 0===t.address?"":t.address,this.notes=void 0===t.notes?"":t.notes,this.favorite=void 0!==t.favorite&&t.favorite,this.listitem=null,this.renderListItem=function(){this.listitem=document.createElement("li"),this.listitem.addEventListener("click",this.clicked.bind(this)),this.favorite&&(this.listitem.className="favorite");var t=document.createTextNode(this.contactname.substring(0,20)),e=""===this.photo?"assets/images/nophoto.png":this.photo;return this.listitem.innerHTML='<img src="'+e+'" alt="" /><div class="contact-name"></div>',this.listitem.getElementsByClassName("contact-name")[0].appendChild(t),this.listitem},this.updateListItem=function(){this.favorite&&(this.listitem.className="favorite");var t=document.createTextNode(this.contactname.substring(0,20)),e=""===this.photo?"assets/images/nophoto.png":this.photo;return this.listitem.innerHTML='<img src="'+e+'" alt="" /><div class="contact-name"></div>',this.listitem.getElementsByClassName("contact-name")[0].appendChild(t),this.listitem},this.getListItem=function(){return this.updateListItem()},this.clicked=function(){App.detailview.setContact(this),App.editview.setContact(this),App.editview.viewMode(),this.select()},this.select=function(){App.contactList.deselectAll(),this.listitem.classList.add("active")},this.updateContact=function(t){this.contactname=t.contactname||"",this.workphone=t.workphone||"",this.mobilephone=t.mobilephone||"",this.workemail=t.workemail||"",this.privateemail=t.privateemail||"",this.address=t.address||"",this.notes=t.notes||"",App.ajaxhandler.postRequest("contacts/update/"+this.id,{contactname:this.contactname,photo:this.photo,workphone:this.workphone,mobilephone:this.mobilephone,workemail:this.workemail,privateemail:this.privateemail,address:this.address,notes:this.notes},function(t){this.updateListItem()}.bind(this))},this.setFavorite=function(t){App.ajaxhandler.postRequest("contacts/favorite/"+this.id,{favorite:t},function(e){this.favorite=t,this.listitem.className=t?"favorite":"",this.select()}.bind(this))}},ContactList=function(){var t=this;this.contacts=[],this.container=document.getElementById("contactlist"),this.searchbar=document.getElementById("search"),this.init=function(){this.retrieveContacts(),this.searchbar.addEventListener("keyup",this.filterContacts.bind(this))},this.retrieveContacts=function(){App.ajaxhandler.getRequest("contacts",function(t){this.contacts=t.map(function(t){return new Contact(t)}),this.renderContactList()}.bind(this))},this.renderContactList=function(){for(var e in t.contacts)this.container.appendChild(this.contacts[e].renderListItem())},this.showFavorites=function(){var t=this.contacts.filter(function(t){return t.favorite===!0});this.container.innerHTML="";for(var e in t)this.container.appendChild(t[e].getListItem())},this.showAll=function(){this.container.innerHTML="";for(var e in t.contacts)this.container.appendChild(this.contacts[e].getListItem())},this.filterContacts=function(){var t=this.searchbar.value,e=this.contacts.filter(function(e){return e.contactname.toLowerCase().indexOf(t)!=-1});this.container.innerHTML="";for(var i in e)this.container.appendChild(e[i].getListItem())},this.newContact=function(){App.ajaxhandler.postRequest("contacts/new",{contactname:"New Contact"},function(t){this.contacts.push(new Contact({id:t.id,contactname:"New Contact"}));var e=this.contacts.length-1;this.container.appendChild(this.contacts[e].renderListItem()),App.detailview.setContact(this.contacts[e]),App.editview.setContact(this.contacts[e]),this.contacts[e].select(),App.editview.editMode()}.bind(this))},this.deleteContact=function(t){App.ajaxhandler.getRequest("contacts/delete/"+t.id,function(e){this.contacts=this.contacts.filter(function(e){return e!=t}),this.container.innerHTML="",this.renderContactList(),App.detailview.closeView()}.bind(this))},this.deselectAll=function(){for(var t in this.contacts)this.contacts[t].listitem.classList.remove("active")}},DetailView=function(){this.contact=null,this.detailView=document.getElementById("contactdetails"),this.backbtn=document.getElementById("backtolist"),this.favoritebtn=document.getElementById("isfavorite"),this.callbtn=document.getElementById("callbtn"),this.emailbtn=document.getElementById("emailbtn"),this.isOpen=!1,this.init=function(){this.backbtn.addEventListener("click",this.closeView.bind(this)),this.favoritebtn.addEventListener("click",this.favorite.bind(this))},this.setContact=function(t){this.contact=t,this.renderView(),this.openView()},this.openView=function(){this.isOpen||(this.detailView.style.display="block",this.detailView.classList.add("showdetails"),this.detailView.classList.remove("hidedetails"),this.isOpen=!0)},this.closeView=function(){this.isOpen!==!1&&(this.detailView.classList.remove("showdetails"),this.detailView.classList.add("hidedetails"),setTimeout(function(){this.detailView.style.display="none"}.bind(this),200),this.isOpen=!1)},this.fillElement=function(t,e){var t=document.getElementById(t),i=document.createTextNode(e);t.innerHTML="",t.appendChild(i)},this.renderView=function(){var t=""===this.contact.photo?"assets/images/nophoto.png":this.contact.photo;document.getElementById("contactphoto").src=t,this.fillElement("contactname",this.contact.contactname),this.fillElement("workphone",this.contact.workphone),this.fillElement("mobilephone",this.contact.mobilephone),this.fillElement("workemail",this.contact.workemail),this.fillElement("privateemail",this.contact.privateemail),this.fillElement("address",this.contact.address),this.fillElement("notes",this.contact.notes);var e=this.contact.favorite?"favorite-btn-active":"favorite-btn";this.favoritebtn.className=e,this.callbtn.setAttribute("href","tel:"+this.contact.workphone),this.emailbtn.setAttribute("href","mailto:"+this.contact.workemail)},this.favorite=function(){var t=!this.contact.favorite,e=t?"favorite-btn-active":"favorite-btn";this.favoritebtn.className=e,this.contact.setFavorite(t)}},EditView=function(){this.contact=null,this.viewmodeElems=document.getElementsByClassName("viewmode"),this.editmodeElems=document.getElementsByClassName("editmode"),this.fields=["photo","contactname","workphone","mobilephone","workemail","privateemail","address","notes"],this.form=new FormHandler(this.fields),this.editbtn=document.getElementById("editbtn"),this.savebtn=document.getElementById("savebtn"),this.deletebtn=document.getElementById("deletebtn"),this.uploadbtn=document.getElementById("photouploadbtn"),this.init=function(){this.editbtn.addEventListener("click",this.editMode.bind(this)),this.savebtn.addEventListener("click",this.saveContact.bind(this)),this.deletebtn.addEventListener("click",this.deleteContact.bind(this)),this.uploadbtn.addEventListener("change",this.fileChanged)},this.fileChanged=function(){App.ajaxhandler.fileRequest("contacts/uploadphoto",this.files[0],function(t){"success"===t.status?(document.getElementById("contactphoto").src=t.photo,App.editview.contact.photo=t.photo,document.getElementsByName("photo")[0].value=t.photo):alert(t.status)})},this.setContact=function(t){this.contact=t},this.saveContact=function(){this.contact.updateContact(this.form.getAllValues()),App.detailview.renderView(),this.viewMode()},this.deleteContact=function(){App.contactList.deleteContact(this.contact)},this.editMode=function(){this.form.fillForm();for(var t=0;t<this.viewmodeElems.length;t++)this.viewmodeElems[t].style.display="none";for(var t=0;t<this.editmodeElems.length;t++)this.editmodeElems[t].style.display="block";document.getElementsByName("contactname")[0].focus()},this.viewMode=function(){for(var t=0;t<this.viewmodeElems.length;t++)this.viewmodeElems[t].style.display="block";for(var t=0;t<this.editmodeElems.length;t++)this.editmodeElems[t].style.display="none"}},AjaxHandler=function(){this.loading=document.getElementById("loadinggif"),this.uploadgif=document.getElementById("uploadgif"),this.sendRequest=function(t,e,i,n){this.loading.style.display="block";var s=new XMLHttpRequest;s.onreadystatechange=function(){4==s.readyState&&200==s.status&&(n(JSON.parse(s.responseText)),this.loading.style.display="none")}.bind(this),s.open(i,t,!0);var o=this.prepareParams(e);"POST"===i&&(s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.setRequestHeader("Content-length",o.length),s.setRequestHeader("Connection","close")),s.send(o)},this.getRequest=function(t,e){this.sendRequest(t,{},"GET",e)},this.postRequest=function(t,e,i){this.sendRequest(t,e,"POST",i)},this.deleteRequest=function(t,e){this.sendRequest(t,{},"DELETE",e)},this.fileRequest=function(t,e,i){if(!e.type.match("image.*"))return void alert("I want an image, not this...");this.uploadgif.style.display="block";var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(i(JSON.parse(n.responseText)),this.uploadgif.style.display="none")}.bind(this);var s=new FormData;s.append("photo",e,e.name),n.open("POST",t,!0),n.send(s)},this.prepareParams=function(t){var e=[];for(var i in t)e.push(i+"="+encodeURIComponent(t[i]));return e.join("&")}},FormHandler=function(t){this.fields=t,this.getFieldValue=function(t){var e=document.getElementsByName(t);return e.length>0?e[0].value:""},this.getAllValues=function(){var e={};for(var i in this.fields)e[t[i]]=this.getFieldValue(this.fields[i]);return e},this.fillForm=function(){for(var t in this.fields){var e=document.getElementsByName(this.fields[t])[0];document.getElementById(this.fields[t]);e.value=App.editview.contact[this.fields[t]]}}},ButtonHandlers=function(){this.contactsbtns=document.getElementsByClassName("contacts"),this.favoritesbtns=document.getElementsByClassName("favorites"),this.addcontactbtn=document.getElementById("addcontactbtn"),this.init=function(){for(var t=0;t<this.contactsbtns.length;t++)this.contactsbtns[t].addEventListener("click",this.contactsClicked.bind(this)),this.favoritesbtns[t].addEventListener("click",this.favoritesClicked.bind(this));this.addcontactbtn.addEventListener("click",App.contactList.newContact.bind(App.contactList))},this.contactsClicked=function(){for(var t=0;t<this.contactsbtns.length;t++)this.favoritesbtns[t].classList.remove("active"),this.contactsbtns[t].classList.add("active");App.contactList.showAll()},this.favoritesClicked=function(){for(var t=0;t<this.contactsbtns.length;t++)this.favoritesbtns[t].classList.add("active"),this.contactsbtns[t].classList.remove("active");App.contactList.showFavorites()}},App={contactList:new ContactList,detailview:new DetailView,editview:new EditView,buttonhandler:new ButtonHandlers,ajaxhandler:new AjaxHandler,init:function(){App.detailview.init(),App.editview.init(),App.contactList.init(),App.buttonhandler.init()}};App.init();